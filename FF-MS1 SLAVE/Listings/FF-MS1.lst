C51 COMPILER V9.60.0.0   FF_MS1                                                            05/19/2021 10:47:21 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE FF_MS1
OBJECT MODULE PLACED IN .\Objects\FF-MS1.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE FF-MS1.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\FF
                    --MS1.lst) TABS(2) OBJECT(.\Objects\FF-MS1.obj)

line level    source

   1          //-----------------------------------------------------------------------------
   2          // TP5.c
   3          //-----------------------------------------------------------------------------
   4          // AUTH: Mehdi Slama & Julien Pinard
   5          // DATE: L'aube de l'humanité
   6          //
   7          // Target: C8051F02x
   8          // Tool chain: KEIL Microvision 4
   9          //
  10          //-----------------------------------------------------------------------------
  11          #include <C8051F020.h>
  12          #include "c8051F020_SFR16.h"
  13          #include "FF-MS1_Config.h"
  14          #include <stdlib.h>
  15          
  16          sbit LED = P1^6;
  17          char xdata messageBuffer[15];
  18          char xdata recieveBuffer[20];
  19          char* ptr_recieveBuffer;
  20          char i = 0;
  21          char j = 0;
  22          char lMessage = 0;
  23          char nb_char_vide = 0;
  24          bit EOR_flag = 0; //End of Reception flag
  25          
  26          // Prototypes de Fonctions
  27          
  28          void Decodage(){ //Cette fonction écrit le message reçu dans le messageBuffer
  29   1        if (EOR_flag) {
  30   2          EOR_flag = 0;
  31   2          if (recieveBuffer[1] == 'B' && recieveBuffer[2] == 'R'){
  32   3            while (j != lMessage){
  33   4              messageBuffer[j] = recieveBuffer[j+3];
  34   4              j++;
  35   4              }
  36   3      /////////////// Vérification du message-test      
  37   3            if (messageBuffer[0] == 'A' && messageBuffer[1] == 'B' && messageBuffer[2] == 'C'){
  38   4              LED = 1;
  39   4              }
  40   3            }
  41   2        }
  42   1      }
  43          
  44          //-----------------------------------------------------------------------------
  45          //-----------------------------------------------------------------------------
  46          // MAIN Routine
  47          //-----------------------------------------------------------------------------
  48          void main (void) {
  49   1             
  50   1          Init_Device();  // Appel des configurations globales
  51   1          SPI0DAT = 'B';
  52   1          
  53   1      // Début Insertion Code Configuration des périphériques ***********************
  54   1          EA = 1;
C51 COMPILER V9.60.0.0   FF_MS1                                                            05/19/2021 10:47:21 PAGE 2   

  55   1          LED = 0;
  56   1        
  57   1      // Fin Code Initialisations ***************************************************
  58   1        
  59   1      // Début Insertion Code Phase Démarrage *************************************** 
  60   1            
  61   1            
  62   1      // Fin Code phase Démarrage ***************************************************
  63   1        
  64   1        
  65   1        while(1)
  66   1        {
  67   2          Decodage();
  68   2        }
  69   1      }
  70          
  71          //-----------------------------------------------------------------------------
  72          //-----------------------------------------------------------------------------
  73          // Fonctions de configuration des divers périphériques
  74          //-----------------------------------------------------------------------------
  75          // Insérez vos fonctions de configuration ici
  76          
  77          //-----------------------------------------------------------------------------
  78          //-----------------------------------------------------------------------------
  79          // Fonctions d'interruptions
  80          //-----------------------------------------------------------------------------
  81          // Insérez vos fonctions d'interruption ici
  82          
  83          void ISR_SPI0() interrupt 6{
  84   1        SPIF = 0;
  85   1        recieveBuffer[i] = SPI0DAT;
  86   1        if (recieveBuffer[i] == '~'){
  87   2          nb_char_vide++;
  88   2        }
  89   1        if (recieveBuffer[i] == 'H' && recieveBuffer[i-1] == 'U'){
  90   2          lMessage = i-4-nb_char_vide;
  91   2          i = 0;
  92   2          nb_char_vide = 0;
  93   2          EOR_flag = 1;
  94   2        }
  95   1        if (i == 20){
  96   2          i = 0;
  97   2        }
  98   1        i++;
  99   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    228    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     35    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      7    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
